## 初识Kafka

##### 发布与订阅消息系统

在讨论Kafka之前我们先来了解一下发布与订阅消息系统的概念

消息的生产者不会直接把消息发送给消息的接收者而是以某种规则对消息进行分类,接收者订阅它们一遍接收特定类型的消息。发布与订阅系统一般会有一个broker（发布消息的中心点）

##### 消息和批次

kafka是一款基于发布与订阅的消息系统,kafka的数据单元称为消息,消息由字节数据组成,为了提高效率消息会被分批的写入kafka,批次就是一组消息这些消息属于同一个主题和分区,如果每个消息都单独穿梭于网络会导致大量的网络开销,如果把消息分批次传输可以减少网络开销但是延迟就会增大所以要在时间延迟与吞吐量之间做出权衡,批次越大单位时间内处理的消息就越多单个消息的传输时间就越长

##### 主题和分区

* kafka的消息通过主题进行分类,主题可以被分为若干个分区,消Kafka通过分区来实现数据冗余和伸缩性,消息以追加的方式写入分区,然后以FIFO的方式进行顺序读取,因为一个主题可以包含很多分区所以无法保证主题范围内的消息读取顺序

* 分区可以分布在不同的服务器上,所以一个主题可以横跨很多的服务器,以此来提供比单个服务器更强大的性能

##### broker和集群

* 一个独立的kafka机器被称为broker,broker接收来自生产者的消息,为消息设置偏移量并提交消息到磁盘保存

* broker为消费者提供服务对读取分区的请求做出响应返回已提交到磁盘上的消息

* broker是集群的组成部分,每个集群都有一个broker同时充当集群控制器的角色,在集群中一个分区从属于一个broker,该broker被称为该分区的首领，一个分区可以分配个多个broker

* 在一定期限内保留消息是kafka的一个重要特性，默认的保留策略是保留一段时间或者消息达到一定的字节数旧消息就会过期并删除，主题可以配置自己的保留策略可以保留消息到不使用为止

##### Kafka作为消息系统

* 传统的消息有两种模式：队列和发布订阅，在队列模式中消费者从队列读取消息(每个消息只能被一个消费者读取)
* 发布订阅模式：消息广播给消费者
* 这两种模式都有优缺点，队列的优点为允许多个消费者瓜分消息,可以扩展处理, 缺点是一旦消费者处理消息故障后消息丢失

*
kafka比传统的消息系统更能保证消息的顺序性：传统的消息系统按顺序保存数据，如果多个消费者从队列消费则服务器按照顺序发送消息，但是尽管按照顺序发送消息但消息异步传递到消费者可能造成消息顺序的错乱，而kafka并行topic的parition,每个partition仅由同一个消费者组中的一个消费者消费到,并确保消费者是该partition的唯一消费者，并按顺序消费数据 ,每个topic有多个分区，则需要对多个消费者做负载均衡，但请注意，相同的消费者组中不能有比分区更多的消费者，否则多出的消费者一直处于空等待，不会收到消息
